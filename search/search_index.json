{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u03bcGPD Analysis Tool Documentation","text":"<p>This package provides a CLI tool to analyze spectra from a Microgap Gas Pixel Detectors (\u03bcGPDs) and infer the characteristics of the detector, such as the gain, the energy resolution </p>"},{"location":"configs/","title":"Analysis Tasks Documentation","text":"<p>In this documentation there is a full explanation of all the tasks that can be executed through the pipeline in the YAML configuration file and their parameters.</p>"},{"location":"configs/#src.analysis.config.SourceConfig","title":"<code>SourceConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Set the acquisition parameters of the source and the detector.</p> <p>Attributes:</p> Name Type Description <code>energy</code> <code>float</code> <p>The energy of the main emission line, expressed in keV. Default is K-alpha of Fe55 (5.9keV).</p> <code>w</code> <code>float</code> <p>W-value of the gas used in the detector, expressed in eV. Default is 26.0 eV, which is the W-value of Argon.</p>"},{"location":"configs/#src.analysis.config.CalibrationConfig","title":"<code>CalibrationConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Perform the detector calibration using pulse data at fixed voltages.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'calibration'.</p> <code>charge_conversion</code> <code>(bool, optional)</code> <p>Whether to convert the calibration to charge (fC) or leave it in voltage (mV). Default is True.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plots of the calibration process. Default is False.</p>"},{"location":"configs/#src.analysis.config.FitSpecConfig","title":"<code>FitSpecConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Perform the spectrum fitting for each source file using the model and the fit parameters defined in the fitting subtasks.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'fit_spec'.</p> <code>subtasks</code> <code>list[FitSubtask]</code> <p>List of fitting subtasks to perform. Each subtask defines the model and the fit parameters to use for the fit.</p>"},{"location":"configs/#src.analysis.config.FitSubtaskConfig","title":"<code>FitSubtaskConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Define a subtask for fitting data.</p> <p>Attributes:</p> Name Type Description <code>target</code> <code>str</code> <p>Assign a name to the fitting subtask. The target name can then be used to use the fit results in other tasks (e.g. plot or gain).</p> <code>model</code> <code>str</code> <p>The name of the model to use for the fit. If spectrum fitting is performed, the model must be one between Gaussian and Fe55Forest defined in aptapy.models. When fitting other data, any model or composite model defined in aptapy.models can be used. To specify a composite model, the syntax is \"Model1 + Model2 + ...\".</p> <code>fit_pars</code> <code>(FitPars, optional)</code> <p>Fit parameters for the fitting subtask. Default values are defined in FitPars.</p>"},{"location":"configs/#src.analysis.config.GainConfig","title":"<code>GainConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Perform the gain calculation for each source file using the results of the fitting subtasks. The gain is calculated as the ratio between the inferred charge from the fit results and the expected number of electrons for the given peak energy.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'gain'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the gain calculation.</p> <code>fit</code> <code>(bool, optional)</code> <p>Whether to fit the gain values with an exponential function of the voltage. If a single source file is analyzed, the fit is not performed. Default is True.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the gain values as a function of the back voltage. If a single source file is analyzed, the plot is not generated. Default is True.</p>"},{"location":"configs/#src.analysis.config.CompareGainConfig","title":"<code>CompareGainConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Compare the gain vs back voltage curves for multiple source folders. A gain task must be performed before the compare gain task.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'compare_gain'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the gain calculation.</p> <code>combine</code> <code>(list[str], optional)</code> <p>List of folder names to combine in the same curve. If a folder name is not specified, another curve will be generated in the same plot. Default is an empty list, which means that no folders will be combined.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the gain comparison. Default is True.</p>"},{"location":"configs/#src.analysis.config.ResolutionConfig","title":"<code>ResolutionConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Perform the resolution calculation for each source file using the results of the fitting subtasks. The resolution is calculated using the charge calibrated spectra as the FWHM of the peak divided by the peak position.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'resolution'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the resolution calculation.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the resolution values as a function of the back voltage. If a single source file is analyzed, the plot is not generated. Default is True.</p>"},{"location":"configs/#src.analysis.config.ResolutionEscapeConfig","title":"<code>ResolutionEscapeConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Perform the resolution escape calculation for each source file using the results of the fitting subtasks. The resolution escape is calculated as the FWHM of the main peak divided by the peak position, normalized to the ratio between the distance between the main peak and the escape peak and the energy difference between them. When using a charge calibrated spectrum, this estimate is equivalent to the previous one.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'resolution_escape'.</p> <code>target_main</code> <code>str</code> <p>The target name of the fitting subtask to use for the main peak.</p> <code>target_escape</code> <code>str</code> <p>The target name of the fitting subtask to use for the escape peak.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the resolution escape values as a function of the back voltage. If a single source file is analyzed, the plot is not generated. Default is True.</p>"},{"location":"configs/#src.analysis.config.CompareResolutionConfig","title":"<code>CompareResolutionConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Compare the resolution vs back voltage curves for multiple source folders. A resolution task must be performed before the compare resolution task.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'compare_resolution'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the resolution calculation.</p> <code>combine</code> <code>(list[str], optional)</code> <p>List of folder names to combine in the same curve. If a folder name is not specified, another curve will be generated in the same plot. Default is an empty list, which means that no folders will be combined.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the resolution comparison. Default is True.</p>"},{"location":"configs/#src.analysis.config.TrendGainConfig","title":"<code>TrendGainConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Analyze the gain trend as a function of time. For each source file, the gain is calculated and then plotted as a function of the acquisition time. If a fitting subtask is specified, the gain trend can be fitted with a model or a composite model defined in aptapy.models.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'gain_trend'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the gain calculation.</p> <code>subtasks</code> <code>(list[FitSubtask], optional)</code> <p>List of fitting subtasks to perform on the gain trend. Each subtask defines the model and the fit parameters to use for the fit. Default is None, which means that the trend is not fitted.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the gain trend as a function of time. Default is True.</p>"},{"location":"configs/#src.analysis.config.CompareTrendConfig","title":"<code>CompareTrendConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Compare the gain trends as a function of time for multiple folders. A gain trend task must be performed before the compare trend task.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'compare_trend'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the gain trend calculation.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the gain trend comparison. Default is True.</p>"},{"location":"configs/#src.analysis.config.DriftConfig","title":"<code>DriftConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Perform the analysis of the gain as a function of drift voltage for each source file using the results of the fitting subtasks. The gain is calculated as the ratio between the inferred charge from the fit results and the expected number of electrons for the given peak energy. If specified, analyze the rate of events above a given energy threshold as a function of the drift voltage.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'drift'.</p> <code>target</code> <code>str</code> <p>The target name of the fitting subtask to use for the gain calculation.</p> <code>energy_threshold</code> <code>(float, optional)</code> <p>Energy threshold to consider for the rate calculation. Default is 1.5 keV.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to generate and show the plot of the gain and rate values as a function of the drift voltage. If a single source file is analyzed, the plot is not generated. Default is True.</p> <code>show_rate</code> <code>(bool, optional)</code> <p>Whether to show the rate values as a function of the drift voltage on the same plot of the gain. Default is True.</p>"},{"location":"configs/#src.analysis.config.PlotConfig","title":"<code>PlotConfig</code>","text":"<p>               Bases: <code>BaseModel</code></p> <p>Plot the spectra and the fit results for each source file. It is possible to specify different plotting options and choose which fit results to show.</p> <p>Attributes:</p> Name Type Description <code>task</code> <code>str</code> <p>Name of the task, to perform it must be 'plot'.</p> <code>targets</code> <code>list[str] | None</code> <p>List of target names of the fitting subtasks to show in the plot. If None, the entire spectrum is shown, with no best-fit curve. Default is None.</p> <code>task_labels</code> <code>list[str] | None</code> <p>List of analysis task result labels to show in the plot legend. If None, no result is shown in the legend. Default is None.</p> <code>voltage</code> <code>(bool, optional)</code> <p>Whether to show the source voltage information in the plot legend. Default is False.</p> <code>xrange</code> <code>list[float] | None</code> <p>Range of x values to show in the plot. If None, the range is automatically determined from the best-fit results, taking 5 sigma around the peak(s) position(s). Default is None.</p> <code>xmin_factor</code> <code>float</code> <p>Factor to multiply the automatically determined minimum x value for the plot. Default is 1.</p> <code>xmax_factor</code> <code>float</code> <p>Factor to multiply the automatically determined maximum x value for the plot. Default is 1.</p> <code>show</code> <code>(bool, optional)</code> <p>Whether to show the generated plot. Default is True.</p>"},{"location":"examples/","title":"Examples of Analysis","text":"<p>To run the analysis, first you need to write the configuration file following the Analysis and Configuration Guide.</p>"},{"location":"examples/#single-file-analysis","title":"Single file analysis","text":"<p>In this example, a basic analysis of a single source file is performed. See the configuration YAML file snippet for more details.</p> <pre><code># Set the properties of the source and detector. This part is optional if the source\n# is Fe55 and if the gas is Ar\nsource:\n  energy: 5.9\n  w: 26.0\n\n# Define the analysis pipeline\npipeline:\n  # Execute the calibration\n  - task: calibration\n    show: false\n\n  - task: fit_spec\n    subtasks:\n      # Fit the main line of the spectrum with a double Gaussian\n      - target: main\n        model: Fe55Forest\n\n    # Estimate the gain using the main line fit  \n  - task: gain\n    target: main\n\n    # Estimate the resolution of the main line using Fe55Forest fit \n  - task: resolution\n    target: main\n\n  - task: plot\n    # Plot the spectrum in the region around the main line showing both fits\n    targets:\n      - main\n    # Show the gain and resolution results in the legend\n    task_labels:\n      - gain\n      - resolution\n    # Scale the xrange on the left to show the escape peak, which of Fe55 is\n    # located at about half the charge of the main peak.\n    xmin_factor: 0.5\n\n# Configure the style of the spectrum plot\nstyle:\n  tasks:\n    plot:\n      title: $^{55}$Fe Spectrum\n      label: Data label\n      legend_label: Example legend label\n</code></pre> <p>After writing the configuration file, the analysis can be launched from the command line interface with:</p> <pre><code>analysis path_config path_source path_calibration\n</code></pre> <p>After the analysis is completed, the result is the following plot, showing the main emission line and the escape peak, along with the fit models and the legend showing the gain and energy resolution results:</p> <p></p>"},{"location":"examples/#folder-analysis","title":"Folder analysis","text":"<p>In this example, the analysis of a folder is performed. You can see from the configuration YAML file snippet below that the configuration file doesn't differ much from that for the single file analysis. Indeed, the configuration files are quite flexible and most of the tasks can be executed both on single and multiple files or folders. The main difference for some tasks is the possibility to specify particular keys that work only on multiple files, otherwise nothing is done.</p> <pre><code>pipeline:\n  # Execute the calibration\n  - task: calibration\n    show: false\n\n  - task: fit_spec\n    subtasks:\n      # Fit the main line of the spectrum with a double Gaussian.\n      - target: main\n        model: Fe55Forest\n\n    # Estimate the gain from the main line  \n  - task: gain\n    target: main\n    fit: true         # Fit the gain with an exponential model\n    show: true        # Plot gain vs back voltage\n\n    # Estimate the resolution from the main line \n  - task: resolution\n    target: main\n    show: true        # Plot resolution vs back voltage\n\n# Set the style of the tasks plot\nstyle:\n  tasks:\n    # Configure gain task plot\n    gain:\n      marker: d\n      linestyle: --\n      color: black\n      label: Gain data\n      legend_label: $\\mu$GPD\n      title: Gain analysis\n      yscale: log\n\n    resolution:\n      marker: .\n      color: blue\n      label: Resolution data\n      legend_label: $\\mu$GPD\n      title: Energy resolution analysis\n      annotate_min: true\n</code></pre> <p>The command to run is: <pre><code>analysis path_config path_folder\n</code></pre></p> <p>Setting the <code>show</code> key to <code>true</code> for the <code>gain</code> and <code>resolution</code> tasks, the output plots are the following:</p> <p> </p>"},{"location":"examples/#analysis-of-gain-variation-with-time","title":"Analysis of gain variation with time","text":"<p>In this example, the analysis of a folder to study the gain variation with time is performed. The gain is estimated during the task, so it is not necessary to execute a <code>gain</code> task before. The gain is fitted in a fixed range with a composite model <code>StrecthedExponential + Constant</code>.</p> <pre><code>pipeline:\n  # Execute the calibration\n  - task: calibration\n    show: false\n\n  - task: fit_spec\n    subtasks:\n      # Fit the main line of the spectrum with a double Gaussian.\n      - target: main\n        model: Fe55Forest\n\n  # Execute the gain_trend task on the main line of the spectrum\n  - task: gain_trend\n    target: main\n    # Fit the gain trend\n    subtasks:\n      - target: charging\n        model: StretchedExponential + Constant  # Fit with a composite model\n        # Set the fit parameters\n        fit_pars:\n          xmax: 3.8                   # Right limit for fit range\n          p0: [25., 0.6, 0.7, 40.]    # Initial parameters for specified fit model\n</code></pre> <p>The command to run is the same as the Folder Analysis example. The output of the program is the following:</p> <p></p>"},{"location":"examples/#gain-and-resolution-comparison-of-two-folders","title":"Gain and resolution comparison of two folders","text":"<p>In this example, two folders are analyzed to compare the gain and the energy resolution estimates. The gain data is combined together and fitted with a single exponential. The energy resolution is only compared. </p> <p>Note: to execute these tasks, it is necessary to first execute the <code>gain</code> or <code>resolution</code> tasks, and then</p> <pre><code>pipeline:\n  # Execute the calibration\n  - task: calibration\n    show: false\n\n  - task: fit_spec\n    subtasks:\n      - target: main\n        model: Fe55Forest\n\n  # Estimate the gain from the main line  \n  - task: gain\n    target: main\n\n  # Estimate the resolution from the main line\n  - task: resolution\n    target: main\n\n\n  # Execute the task to combine the gain results from two folders and fit the\n  # data with a single exponential model\n  - task: compare_gain\n    target: main\n    combine:                                     # Combine the data\n      - folder\n      - folder1\n\n  # Execute the task to show the energy resolution results from the two folders\n  # without combining the data\n  - task: compare_resolution\n    target: main\n\n# Define the styles for comparison plots\nstyle:\n  # Set the labels for gain and resolution comparison plot\n  tasks:\n    compare_gain:\n      title: Combine gain results\n      legend_label: $\\mu$GPD\n      yscale: linear\n\n    compare_resolution:\n      title: Compare energy resolution results\n      legend_label: $\\mu$GPD\n\n  folders:\n    # Set combined data style (only for gain)\n    combine:\n      label: Combined data\n      marker: .\n      color: black\n      linestyle: \"--\"\n\n    # Set folder data style (for resolution)\n    folder:\n      label: Folder 0 data\n      marker: x\n      color: black\n\n    folder1:\n      label: Folder 1 data\n      marker: v\n      color: red\n</code></pre> <p>To run this analysis the command is:</p> <pre><code>analysis path_config path_folder0 path_folder1\n</code></pre> <p>The output is the following:</p> <p></p> <p></p>"},{"location":"guide/","title":"Analysis and configuration guide","text":""},{"location":"guide/#run-the-analysis","title":"Run the analysis","text":"<p>After the installation, the CLI can be used with the command: <pre><code>analysis config paths\n</code></pre></p> <p>To run the analysis, the requested arguments are the .yaml configuration file path and the data files or folders paths. The .yaml configuration file path is always the first argument.</p> <p>To analyze one or more source files, the command needs a sequence of source file paths and a calibration with pulsed data as the last argument. This is an example of the analysis of two source files using the same calibration file:</p> <pre><code>analysis path_config path_file0 path_file1 path_calibration\n</code></pre> <p>To analyze one or more folders, the order of the arguments is the same as the previous case, with the exception that no calibration file has to be specified, as it is supposed that each folder contains its own calibration file:</p> <pre><code>analysis path_config path_folder0 path_folder1\n</code></pre> <p>The default directory to search for data files or folders is the data directory in the package root. If a file or a folder is inside this directory, there is no need to specify all the path of the folder, but the relative path from the data directory is enough to locate it.</p> <p>It is also possible to save the analysis results (e.g. plots and numerical values) inside the results directory, which is automatically created in the user's home. This option can be enabled using the optional argument <code>-s</code> (or <code>--save</code>) in the CLI command. It is also possible to choose the format to use to save the plots (pdf or png). An example of command to save the results is:</p> <pre><code>analysis path_config path_folder0 -s -f png\n</code></pre>"},{"location":"guide/#file-naming","title":"File naming","text":"<p>To correctly analyze the data, the files have to be named in a specific way, to correctly identify file type, the voltages and also the chronological order.</p>"},{"location":"guide/#calibration-files","title":"Calibration files","text":"<p>For calibration files, the name has to be of the form (case-insensitive):</p> <pre><code>[any_prefix]ci[voltages][any_literal_suffix].mca\n</code></pre> <p>where voltages is a sequence of integers separated by <code>-</code> or <code>_</code>. An example of correct file name is <code>data_ci1-2-3-4mV.mca</code>.</p>"},{"location":"guide/#source-files","title":"Source files","text":"<p>For source files, the name must contain the information about the back <code>B[back_voltage]</code> and the drift <code>D[drift_voltage]</code> voltages. The order in which they appear and where they are written are not important, but in this case it is case-sensitive, so <code>B</code> and <code>D</code> must be capital letters. An example of correct name is <code>data_D1000_B300.mca</code></p>"},{"location":"guide/#time-trend-files","title":"Time trend files","text":"<p>When analyzing data and the chronological order is important, the naming convention is similar to that of source files, with the exceptions that the order of the voltages matters. In particular, the back voltage must be the last to be specified, and after that an index that indicates the order has to be written. The name should be of the following form:</p> <pre><code>[any_prefix]B[voltage]_[index].mca\n</code></pre> <p>An example of correct file name is <code>data_D1000B380_40.mca</code></p>"},{"location":"guide/#write-the-configuration-file","title":"Write the configuration file","text":"<p>To run the analysis, a configuration file must always be specified. This section explains how to write a correct configuration file.</p> <p>The configuration file is a .yaml file which contains all the information to run the analysis and also for the plot style. This file allows to write an analysis pipeline in which each task can be configured.</p> <p>Warning:  when a key is optional and you want to set it to the default value, all the line must be deleted, not only the value, otherwise a type error can be raised or a <code>None</code> value can be assigned to the key.</p>"},{"location":"guide/#source","title":"Source","text":"<p>The source dictionary allows to set the properties of the source, such as the energy of the main emission line, and also the detector constants, such as the W-value of the gas.</p> <p>This dictionary is optional, and none of its field is mandatory. In case a key is not specified, the analysis use the default value.</p> <pre><code>source:\n  energy: 5.9   # Optional, default is K-alpha of Fe55\n  w: 26.0       # Optional, default is w-value of Ar\n</code></pre>"},{"location":"guide/#pipeline","title":"Pipeline","text":"<p>The pipeline is the core of the analysis, where everything that has to be calculated is defined. Each step of the pipeline is a task that contains all the properties that are needed to configure and execute it. The pipeline is structured as a sequence of tasks. Each task is a dictionary, with its own key-value pairs. A task is defined by its name, and the other keys define its behaviour.</p> <p>The tasks order in the configuration file does not affect execution, as priority is automatically assigned to the <code>calibration</code> task (which is mandatory for the pipeline) followed by the <code>fit_spec</code> task (which is optional, e.g. if you only want to plot the data without doing any analysis).</p> <p>Apart from the <code>calibration</code> and <code>fit_spec</code> tasks, which are executed once at the beginning of the analysis, all the other tasks can be written multiple times, specifying different <code>target</code> or configuration parameters. As an example, if you have multiple emission lines in a spectrum and you want to estimate the resolution from each of them independently, it is possible to write a <code>resolution</code> task for each of them by specifying the target declared during the <code>fit_spec</code> subtasks. See the next sections for more details.</p> <p>For a complete description of the possible keys of each task, please see Tasks.</p>"},{"location":"guide/#calibration","title":"Calibration","text":"<p>This task performs the calibration between the ADC counts of the multi-channel analyzer and the charge (or voltage). It is performed using the calibration pulse file specified in the command or located into the folder. This file contains data at fixed known voltages (which must be written in the name), and after fitting each pulse with a Gaussian curve, a linear fit of the peak positions is performed to find the conversion parameters.</p> <pre><code>pipeline:\n\n  - task: calibration\n    charge_conversion: true     # Optional, whether to convert to voltage or charge\n    show: false                 # Optional, plot the calibration results\n</code></pre>"},{"location":"guide/#spectral-fitting","title":"Spectral fitting","text":"<p>This task performs the spectral fitting on one or multiple emission lines at the same time. The task is divided into subtasks, each of them defined by the <code>target</code> (a name given to the subtask), and the <code>model</code> to use for the emission line fit (which must be Gaussian or Fe55Forest). These keys are mandatory for all the subtasks.</p> <p>A subtask also has another optional key, which is <code>fit_pars</code>, that allows to specify some properties of the fitting procedure. If the <code>fit_pars</code> key is written in the configuration file, at least one property must be specified, but none of them is mandatory.</p> <pre><code>  - task: fit_spec\n    subtasks:\n      - target: main_peak\n        model: Fe55Forest\n\n      - target: escape_peak\n        model: Gaussian\n        fit_pars:               # Optional\n          xmin: 2.0             # Optional, left range limit for the fit\n          xmax: 4.              # Optional, right range limit for the fit\n          num_sigma_left: 1.    # Optional, number of sigma to the left of the line center for the fit\n          num_sigma_right: 1.   # Optional, number of sigma to the right of the line center for the fit\n          absoulute_sigma: true # Optional, set absolute sigma\n          p0: [1., 1., 1.]      # Optional, init parameters for the line fit\n</code></pre>"},{"location":"guide/#gain-estimate","title":"Gain estimate","text":"<p>This task performs the estimate of the gain using the spectral fitting results of a given <code>target</code>, previously specified during the fit_spec task.</p> <p>If the analysis is performed on a single file, there are no other keys to specify. If the analysis is performed on multiple files or on one or multiple folders, the <code>fit</code> and <code>plot</code> can be specified. </p> <p>Note: no error is raised if these optional keys are specified during the analysis of a single file, but no fit will be performed and no plot will be shown.</p> <pre><code>  - task: gain\n    target: main_peak\n    fit: true            # Optional, fit the data with an exponential model\n    show: true           # Optional, plot gain vs back voltage\n</code></pre>"},{"location":"guide/#gain-trend-with-time","title":"Gain trend with time","text":"<p>This task performs the study of the gain as a function of time. The gain is estimated in the same way as the gain task. For each source file, the time and the length of the acquisition are extracted from the header. The time info are combined together to get the variation of the gain with time.</p> <p>The gain trend can also be analyzed using fitting subtasks, which allow to fit the data with a model or a composition of models from aptapy.models. These subtasks share the same syntax of the spectral fitting subtasks.</p> <p>If more than one trend is visible in the same data, multiple targets can be specified, and the fit range can be adjusted to each trend.</p> <pre><code>  - task: gain_trend\n    target: main_peak\n    subtasks:                         # Optional, fitting subtasks\n      target: trend                   \n      model: Exponential + Constant   # Composition of models \n</code></pre>"},{"location":"guide/#gain-compare-between-folders","title":"Gain compare between folders","text":"<p>This task allows to compare the gain results of two or more different folders on the same plot. To execute this task, it is required that at least a <code>gain</code> task has been completed on a given <code>target</code> emission line.</p> <p>It is also possible to combine the gain estimates from a list of folders specified in the <code>combine</code> key, and also perform a single exponential fit on the data from these folders.</p> <p>If there are multiple data taken at a given voltage, the mean of the gain estimated from these files is calculated.</p> <pre><code>  - task: compare_gain\n    target: main_peak\n    combine:                     # Optional, combine the data of the specified folders\n      - folder0\n      - folder1\n</code></pre>"},{"location":"guide/#drift-varying","title":"Drift varying","text":""},{"location":"guide/#resolution-estimate","title":"Resolution estimate","text":"<p>This task performs the estimate of the resolution of the detector using the spectral fitting results of a given <code>target</code>, previously specified during the fit_spec task. This estimate is made using only the fitted FWHM of the line and the calibrated charge of the line center: $$ \\frac{\\Delta E}{E} = \\frac{\\text{FWHM}}{E}. $$ The result is reported as a percentage.</p> <p>As for the gain task, the <code>show</code> key works only if the analysis is performed on multiple files or folders</p> <pre><code>  - task: resolution\n    target: main_peak\n    show: true            # Optional, plot resolution vs back voltage\n</code></pre>"},{"location":"guide/#resolution-estimate-with-escape-peak","title":"Resolution estimate with escape peak","text":"<p>This task performs the estimate of the resolution of the detector using the spectral fitting results of a main line emission and the correspondent escape peak. The two emission lines are specified by the <code>target_main</code> and <code>target_escape</code> keys. The resolution is estimated as: $$ \\frac{\\Delta E}{E} = \\frac{\\text{FWHM}}{E_{main}} \\frac{E_{main} - E_{peak}}{x_{main} - x_{peak}}, $$ where \\(E_{main}\\) and \\(E_{peak}\\) are the theoretical emission energies of the main and the escape peaks, and \\(x_{main}\\) and \\(x_{peak}\\) are the fitted line center positions. This estimate and the previous lead to the same result if the charge calibration has been correctly performed.</p> <p>The <code>show</code> and <code>fit</code> keys can be specified if working on multiple files.</p> <pre><code>  - task: resolution_escape\n    target_main: main_peak\n    target_escape: escape_peak\n</code></pre>"},{"location":"guide/#resolution-compare-between-folders","title":"Resolution compare between folders","text":"<p>This task allows to compare the energy resolution between different folders. As for <code>compare_gain</code> task, you need first to perform a <code>resolution</code> task on a <code>target</code> to compare the results. </p> <p>You can combine the results of different folders by specifying a list with the names of folders to combine in the <code>combine</code> key.</p> <pre><code>  - task: compare_resolution\n    target: main_peak\n    combine:      # Optional, combine the results from the specified folders\n      - folder0\n      - folder1\n</code></pre>"},{"location":"guide/#plot-the-spectrum","title":"Plot the spectrum","text":"<p>This task is used to plot the spectrum of all the analyzed files. It is possible to plot the spectrum without performing the spectral fitting before writing only the name of the task.</p> <p>In the case of spectral fitting and physical quantities estimate, it is possible to specify the <code>target</code> to plot, the general <code>label</code> of the plot, if you want to show the quantity estimates in the legend using <code>task_labels</code> and where to show the legend with <code>loc</code>. It is also possible to set a specific x-axis range for the plot using <code>xrange</code> or modify the automatic one by a factor on the left and/or on the right with <code>xmin_factor</code> and <code>xmax_factor</code>. If the <code>xrange</code> has been specified, it has the priority over the other two keys. You can decide whether to show the plots with the <code>show</code> key.</p> <pre><code>  - task: plot\n    targets:              # Optional, target fit to show\n      - main_peak\n      - escape_peak\n    task_labels:          # Optional, estimated quantities to show in the legend\n      - gain\n    xrange: [0., 3.]      # Optional, the x-axis range to show on the plot\n    xmin_fac: 0.5         # Optional, scale the automatic xrange left limit by a factor\n    xmax_fac: 1.5         # Optional, scale the automatic xrange right limit by a factor\n    show: true            # Optional, whether to show the plot. If false, they can still be saved.\n</code></pre>"},{"location":"guide/#style","title":"Style","text":"<p>The style dictionary allows to set the style, labels and titles of the plots. The main keys of this dictionary are <code>tasks</code> and <code>folders</code>. To each of them can be assigned other dictionaries, whose key is the name of a task or a folder. Inside the latter dictionaries, the style settings of the plots can be specified.</p> <p>The <code>tasks</code> dictionary allows to modify the style and labels of the plots produced during tasks (e.g. <code>gain</code>, <code>resolution</code>, etc...).</p> <p>The <code>folders</code> dictionary is useful when producing plots with comparison between different folders. The labels, color, marker and line style of data points and best-fit curves can be configured. It is also possible to configure the label and style of combined results specifying the key <code>combine</code>.</p> <pre><code>style:\n  # For tasks the syntax is the following  \n  tasks:\n    # Name of the task\n    plot:\n      # Configure the settings\n      title: $^{55}$Fe spectrum\n      legend_label: Chip\n      label: null\n\n  # For folders\n  folders:\n    # Specify the name of the folder\n    folder0:  \n      label: Folder 0 Data\n      marker: .\n      color: black\n      linestyle: \"-\"\n</code></pre>"}]}